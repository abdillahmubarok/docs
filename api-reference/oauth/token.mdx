---
title: Token Endpoint
description: API reference for the Mubarokah ID OAuth 2.0 Token Endpoint (/oauth/token). Used to exchange authorization codes or refresh tokens for access tokens.
---

# Token Endpoint

The Token Endpoint is used to obtain an access token (and optionally a refresh token) by presenting an authorization grant. Mubarokah ID supports multiple grant types at this endpoint, primarily the `authorization_code` grant, `refresh_token` grant, and `client_credentials` grant.

<RequestExample method="POST" url="https://mubarokah.id/oauth/token">
  ```text Basic
  POST /oauth/token HTTP/1.1
  Host: mubarokah.id
  Content-Type: application/x-www-form-urlencoded
  Authorization: Basic base64(client_id:client_secret) // Optional if client_id/secret in body
  ...
  ```
</RequestExample>

All requests to the token endpoint **must be `POST` requests** and the body **must be `application/x-www-form-urlencoded`**.

Client authentication can be performed either by including `client_id` and `client_secret` in the request body or by using HTTP Basic authentication with the `client_id` as the username and `client_secret` as the password.

## Grant Types Supported

<Tabs>
  <Tab title="Authorization Code Grant">
    This is the most common grant type used after a user authorizes your application. You exchange the `authorization_code` (obtained from the redirect to your `redirect_uri` after user consent) for an access token and a refresh token.

    **Request Body Parameters (`application/x-www-form-urlencoded`):**

    | Parameter        | Type   | Required | Description                                                                     |
    |------------------|--------|----------|---------------------------------------------------------------------------------|
    | `grant_type`     | string | ✅        | **Must be `authorization_code`**.                                               |
    | `code`           | string | ✅        | The authorization code received from the `/oauth/authorize` redirect.           |
    | `redirect_uri`   | string | ✅        | The same `redirect_uri` that was used in the initial authorization request.     |
    | `client_id`      | string | ✅        | Your application's Client ID. (Required if not using Basic Auth header)           |
    | `client_secret`  | string | ✅        | Your application's Client Secret. (Required if not using Basic Auth header)       |
    | `code_verifier`  | string | ❌        | If PKCE was used in the authorization request, this is the original `code_verifier` string. Required for public clients that used PKCE. |

    **Example Request (Node.js - Server-Side):**
    ```javascript
    const fetch = require('node-fetch'); // Or your preferred HTTP client

    const CLIENT_ID = "your_client_id";
    const CLIENT_SECRET = "your_client_secret"; // Keep this secure on the server!
    const REDIRECT_URI = "https://yourapp.com/callback";
    const authorizationCode = "code_from_authorize_redirect";
    // const codeVerifier = "pkce_code_verifier_if_used"; // From session/storage

    async function exchangeCodeForTokens(code, codeVerifier) {
      const params = new URLSearchParams();
      params.append('grant_type', 'authorization_code');
      params.append('code', code);
      params.append('redirect_uri', REDIRECT_URI);
      params.append('client_id', CLIENT_ID);
      params.append('client_secret', CLIENT_SECRET);

      if (codeVerifier) {
        params.append('code_verifier', codeVerifier);
      }

      try {
        const response = await fetch('https://mubarokah.id/oauth/token', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/x-www-form-urlencoded',
            // Example of Basic Auth (alternative to client_id/secret in body):
            // 'Authorization': 'Basic ' + Buffer.from(CLIENT_ID + ':' + CLIENT_SECRET).toString('base64')
          },
          body: params
        });

        const tokenData = await response.json();

        if (!response.ok) {
          throw new Error(tokenData.error_description || tokenData.error || 'Token exchange failed');
        }
        return tokenData;
      } catch (error) {
        console.error('Token Exchange Error:', error.message);
        throw error;
      }
    }

    // exchangeCodeForTokens(authorizationCode, codeVerifierValue);
    ```

    **Example Successful Response (JSON):**
    ```json
    {
      "token_type": "Bearer",
      "expires_in": 86400,
      "access_token": "eyJhbGciOiJSUzI1NiIs...",
      "refresh_token": "def5020023761949f076f0698738501d013...",
      "scope": "view-user detail-user"
    }
    ```
  </Tab>
  <Tab title="Refresh Token Grant">
    When an access token expires, you can use a refresh token to obtain a new access token (and potentially a new refresh token) without requiring the user to re-authenticate.

    **Request Body Parameters (`application/x-www-form-urlencoded`):**

    | Parameter        | Type   | Required | Description                                                                 |
    |------------------|--------|----------|-----------------------------------------------------------------------------|
    | `grant_type`     | string | ✅        | **Must be `refresh_token`**.                                                |
    | `refresh_token`  | string | ✅        | The refresh token issued to your application.                               |
    | `client_id`      | string | ✅        | Your application's Client ID. (Required if not using Basic Auth header)       |
    | `client_secret`  | string | ✅        | Your application's Client Secret. (Required if not using Basic Auth header)   |
    | `scope`          | string | ❌        | Optional. A space-separated list of scopes. You can request a subset of the original scopes. If omitted, the new access token will have the same scopes as the original, or a default set if the refresh token is not scoped. |

    **Example Request (Node.js - Server-Side):**
    ```javascript
    const fetch = require('node-fetch');

    const CLIENT_ID = "your_client_id";
    const CLIENT_SECRET = "your_client_secret";
    const currentRefreshToken = "user_s_refresh_token";

    async function refreshAccessToken(refreshToken) {
      const params = new URLSearchParams();
      params.append('grant_type', 'refresh_token');
      params.append('refresh_token', refreshToken);
      params.append('client_id', CLIENT_ID);
      params.append('client_secret', CLIENT_SECRET);
      // params.append('scope', 'view-user'); // Optionally request narrower scopes

      try {
        const response = await fetch('https://mubarokah.id/oauth/token', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/x-www-form-urlencoded',
          },
          body: params
        });

        const tokenData = await response.json();

        if (!response.ok) {
          throw new Error(tokenData.error_description || tokenData.error || 'Token refresh failed');
        }
        // A new refresh token might be issued, always update your stored refresh token if one is returned.
        return tokenData;
      } catch (error) {
        console.error('Token Refresh Error:', error.message);
        // If refresh fails, the user may need to re-authenticate via the authorization code flow.
        throw error;
      }
    }

    // refreshAccessToken(currentRefreshToken);
    ```

    **Example Successful Response (JSON):**
    ```json
    {
      "token_type": "Bearer",
      "expires_in": 86400,
      "access_token": "new_eyJhbGciOiJSUzI1NiIs...",
      "refresh_token": "new_def5020023761949f076f0698...", // Sometimes a new refresh token is returned
      "scope": "view-user detail-user"
    }
    ```
    <Info>
    Always store the new `refresh_token` if one is returned in the response, as the old one might be invalidated.
    </Info>
  </Tab>
  <Tab title="Client Credentials Grant">
    This grant is used for machine-to-machine (M2M) authentication, where your application needs to access its own resources or act on its own behalf, not on behalf of a user.

    **Request Body Parameters (`application/x-www-form-urlencoded`):**

    | Parameter        | Type   | Required | Description                                                                 |
    |------------------|--------|----------|-----------------------------------------------------------------------------|
    | `grant_type`     | string | ✅        | **Must be `client_credentials`**.                                           |
    | `client_id`      | string | ✅        | Your application's Client ID. (Required if not using Basic Auth header)       |
    | `client_secret`  | string | ✅        | Your application's Client Secret. (Required if not using Basic Auth header)   |
    | `scope`          | string | ❌        | Optional. A space-separated list of scopes relevant to your application's own operations (e.g., `internal-stats-access`). |

    **Example Request (Node.js - Server-Side):**
    ```javascript
    const fetch = require('node-fetch');

    const CLIENT_ID = "your_m2m_client_id";
    const CLIENT_SECRET = "your_m2m_client_secret";

    async function getAppAccessToken() {
      const params = new URLSearchParams();
      params.append('grant_type', 'client_credentials');
      params.append('client_id', CLIENT_ID);
      params.append('client_secret', CLIENT_SECRET);
      // params.append('scope', 'some-client-specific-scope');

      try {
        const response = await fetch('https://mubarokah.id/oauth/token', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/x-www-form-urlencoded',
          },
          body: params
        });

        const tokenData = await response.json();

        if (!response.ok) {
          throw new Error(tokenData.error_description || tokenData.error || 'Client credentials grant failed');
        }
        // This grant type typically does not return a refresh token.
        return tokenData;
      } catch (error) {
        console.error('Client Credentials Grant Error:', error.message);
        throw error;
      }
    }

    // getAppAccessToken();
    ```

    **Example Successful Response (JSON):**
    ```json
    {
      "token_type": "Bearer",
      "expires_in": 3600, // Typically shorter lifetime
      "access_token": "app_eyJhbGciOiJSUzI1NiIs...",
      "scope": "client-specific-scope"
    }
    ```
    <Info>
    The Client Credentials grant usually does not return a `refresh_token`. When the `access_token` expires, your application must request a new one using the same grant.
    </Info>
  </Tab>
</Tabs>

## Common Response Parameters

Upon a successful request, the token endpoint will return a JSON object containing:

| Parameter       | Type   | Description                                                                                                |
|-----------------|--------|------------------------------------------------------------------------------------------------------------|
| `access_token`  | string | The access token that your application can use to make requests to protected resources on behalf of the user or itself. |
| `token_type`    | string | Typically `Bearer`. Indicates how the access token should be used in API requests (e.g., `Authorization: Bearer <access_token>`). |
| `expires_in`    | number | The lifetime of the access token in seconds (e.g., `3600` for 1 hour, `86400` for 24 hours).                |
| `refresh_token` | string | (Optional) An opaque token that can be used to obtain a new access token when the current one expires. Usually returned with the `authorization_code` grant. |
| `scope`         | string | (Optional) If the granted scopes are different from what was requested, this parameter will list the actual granted scopes. |

## Error Responses

If a request to the token endpoint fails, it will return a JSON error response with an `error` and `error_description` field.

**Example Error Response (JSON):**
```json
{
  "error": "invalid_grant",
  "error_description": "The provided authorization grant (e.g., authorization code, resource owner credentials) or refresh token is invalid, expired, revoked, does not match the redirection URI used in the authorization request, or was issued to another client.",
  "message": "The provided authorization grant (e.g., authorization code, resource owner credentials) or refresh token is invalid, expired, revoked, does not match the redirection URI used in the authorization request, or was issued to another client.",
  "hint": "Check the authorization code or refresh token and try again."
}
```
Refer to the [Error Codes section](../error-codes) for a comprehensive list of possible OAuth error codes returned by this endpoint.
